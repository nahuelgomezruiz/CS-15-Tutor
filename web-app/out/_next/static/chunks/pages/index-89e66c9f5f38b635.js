(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{6760:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(8462)}])},8462:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>E});var s=r(7876),a=r(4232),n=r(1423);let l={text:"Hi! I'm an experimental AI tutor for CS15. Queries are logged to help improve the tool. Responses may be inaccurate, so please think critically. Feel free to send feedback to nahuel.gomez_ruiz@tufts.edu.",sender:"bot",isStreaming:!1},o=()=>{let[e,t]=(0,a.useState)([l]),[r,s]=(0,a.useState)(""),[o,i]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=localStorage.getItem("conversationId");if(e)s(e);else{let e=(0,n.A)();localStorage.setItem("conversationId",e),s(e)}},[]),{messages:e,conversationId:r,isTyping:o,setIsTyping:i,addMessage:e=>{t(t=>[...t,e])},updateLastMessage:function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t(t=>{let s=[...t],a=s[s.length-1];return a&&"bot"===a.sender&&(a.text=e,a.isStreaming=r),s})}}},i={production:{baseUrl:"https://cs-15-tutor.onrender.com"}},c=()=>i.production.baseUrl;class u{async getAuthenticatedUser(){try{let e=window.location.hostname.includes(".tufts.edu");if(e){let e=window.location.pathname.match(/\/~([^\/]+)\//);if(e)return this.authenticatedUser=e[1],this.authenticatedUser}let t=localStorage.getItem("tufts_authenticated_user");if(t)return this.authenticatedUser=t,this.authenticatedUser;if(e&&!this.authenticatedUser){let e=prompt("Please enter your Tufts username (you are already authenticated):");if(e&&e.trim())return this.authenticatedUser=e.trim().toLowerCase(),localStorage.setItem("tufts_authenticated_user",this.authenticatedUser),this.authenticatedUser}return null}catch(e){return console.error("Error getting authenticated user:",e),null}}async getAuthHeaders(){let e=await this.getAuthenticatedUser(),t={};return e&&(t["X-Remote-User"]=e,t["X-Tufts-Authenticated"]="true",t["X-Frontend-Domain"]=window.location.hostname),t}clearAuthentication(){this.authenticatedUser=null,localStorage.removeItem("tufts_authenticated_user")}constructor(){this.authenticatedUser=null}}let d=new u;var h=r(5364);class m{async sendMessage(e,t,r){try{var s;let a=await d.getAuthHeaders(),n={"Content-Type":"application/json",...a};"true"!==h.env.DEVELOPMENT_MODE||a["X-Remote-User"]||(n["X-Development-Mode"]="true",n["X-Remote-User"]="testuser");let l=await fetch("".concat(this.baseUrl,"/api/stream"),{method:"POST",headers:n,body:JSON.stringify({message:e,conversationId:t})});if(!l.ok)throw Error("HTTP error! status: ".concat(l.status));let o=null==(s=l.body)?void 0:s.getReader(),i=new TextDecoder,c="";if(!o)throw Error("No response body");for(;;){let{done:e,value:t}=await o.read();if(e)break;let s=(c+=i.decode(t,{stream:!0})).split("\n");for(let e of(c=s.pop()||"",s))if(e.startsWith("data: ")){let t=e.slice(6);if(t.trim())try{let e=JSON.parse(t);if("loading"===e.status&&r)r("Looking at course content...");else if("thinking"===e.status&&r)r("Thinking...");else if("complete"===e.status)return{response:e.response,rag_context:e.rag_context,conversation_id:e.conversation_id,health_status:e.health_status};else if("error"===e.status)throw Error(e.error||"Unknown error")}catch(e){console.error("Error parsing SSE data:",e)}}}throw Error("Stream ended without complete status")}catch(e){throw console.error("Error sending message:",e),Error("Error generating answer.")}}async checkHealth(){try{let e=await fetch("".concat(this.baseUrl,"/health"));return await e.json()}catch(e){throw console.error("Health check failed:",e),e}}async getHealthStatus(){try{let e=await d.getAuthHeaders(),t={...e};"true"!==h.env.DEVELOPMENT_MODE||e["X-Remote-User"]||(t["X-Development-Mode"]="true",t["X-Remote-User"]="testuser");let r=await fetch("".concat(this.baseUrl,"/health-status"),{headers:t});if(!r.ok)throw Error("HTTP error! status: ".concat(r.status));return await r.json()}catch(e){throw console.error("Health status check failed:",e),e}}constructor(){this.baseUrl=c()}}let g=new m,x=()=>{let{messages:e,conversationId:t,isTyping:r,setIsTyping:s,addMessage:n,updateLastMessage:l}=o(),[i,c]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=async()=>{try{let e=await g.getHealthStatus();c(e)}catch(e){console.error("Failed to fetch health status:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]),{messages:e,isTyping:r,sendMessage:async e=>{if(e.trim()){if(i&&!i.can_query)return void n({text:"You've run out of queries. Please wait for your health points to regenerate.",sender:"bot"});n({text:e,sender:"user"}),s(!0),n({text:"Looking at course content...",sender:"bot",isStreaming:!0});try{let r=await g.sendMessage(e,t,e=>{l(e,!0)});r.response?(l(r.response,!1),console.log("RAG Context:",r.rag_context),r.health_status&&c(r.health_status)):r.error&&(l("Error: ".concat(r.error),!1),r.health_status&&c(r.health_status))}catch(e){console.error("Error sending message:",e),l(e instanceof Error?"Error: ".concat(e.message):"Error: An unexpected error occurred",!1)}finally{s(!1)}}},healthStatus:i}},f=e=>{let t=(0,a.useRef)(null),r=(0,a.useRef)(!0);return(0,a.useEffect)(()=>{t.current&&r.current&&(t.current.scrollTop=t.current.scrollHeight)},e),{chatRef:t,handleScroll:()=>{if(!t.current)return;let{scrollTop:e,scrollHeight:s,clientHeight:a}=t.current;r.current=s-e<=a+50}}};var b=r(9720);let y=()=>(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-gray-300"}),p=e=>{let{message:t}=e,r="user"===t.sender,a=t.isStreaming&&("Looking at course content..."===t.text||"Thinking..."===t.text);return(0,s.jsx)("div",{className:"flex ".concat(r?"justify-end":"justify-start"," mb-4"),children:(0,s.jsx)("div",{className:"px-4 py-3 rounded-2xl max-w-[80%] shadow-sm ".concat(r?"bg-blue-600 text-white rounded-br-md":a?"bg-gray-700 text-gray-400 italic rounded-bl-md":"bg-gray-700 text-gray-100 rounded-bl-md"),children:a?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(y,{}),(0,s.jsx)("span",{children:t.text})]}):r?(0,s.jsx)("div",{className:"whitespace-pre-wrap break-words text-sm",children:t.text}):(0,s.jsx)(b.oz,{className:"prose prose-sm max-w-none prose-p:my-2 prose-headings:my-2 text-sm prose-invert",components:{p:e=>{let{children:t}=e;return(0,s.jsx)("p",{className:"mb-2 last:mb-0 text-gray-100",children:t})},pre:e=>{let{children:t}=e;return(0,s.jsx)("div",{className:"overflow-x-auto my-2",children:(0,s.jsx)("pre",{className:"bg-gray-900 text-gray-100 p-3 rounded-lg overflow-x-auto text-xs border border-gray-600",children:t})})},code:e=>{let{className:t,children:r}=e;return t&&t.includes("language-")?(0,s.jsx)("code",{className:"bg-gray-900 text-gray-100",children:r}):(0,s.jsx)("code",{className:"bg-gray-600 text-gray-100 px-1 py-0.5 rounded text-xs",children:r})},h1:e=>{let{children:t}=e;return(0,s.jsx)("h1",{className:"text-lg font-bold text-gray-100 mb-2",children:t})},h2:e=>{let{children:t}=e;return(0,s.jsx)("h2",{className:"text-base font-bold text-gray-100 mb-2",children:t})},h3:e=>{let{children:t}=e;return(0,s.jsx)("h3",{className:"text-sm font-bold text-gray-100 mb-2",children:t})},ul:e=>{let{children:t}=e;return(0,s.jsx)("ul",{className:"list-disc list-inside text-gray-100 mb-2",children:t})},ol:e=>{let{children:t}=e;return(0,s.jsx)("ol",{className:"list-decimal list-inside text-gray-100 mb-2",children:t})},li:e=>{let{children:t}=e;return(0,s.jsx)("li",{className:"text-gray-100 mb-1",children:t})},strong:e=>{let{children:t}=e;return(0,s.jsx)("strong",{className:"font-bold text-gray-100",children:t})},em:e=>{let{children:t}=e;return(0,s.jsx)("em",{className:"italic text-gray-100",children:t})}},children:t.text})})})},w=e=>{let{children:t,...r}=e;return(0,s.jsx)("button",{...r,className:"px-4 py-2 rounded-full bg-cyan-600 text-black ".concat(r.className),children:t})};var v=r(329);let j=e=>{let{onSendMessage:t,isDisabled:r=!1}=e,[n,l]=(0,a.useState)(""),o=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(o.current){o.current.style.height="auto";let e=o.current.scrollHeight;o.current.style.height="".concat(Math.min(e,200),"px")}},[n]);let i=()=>{n.trim()&&!r&&(t(n),l(""))};return(0,s.jsxs)("div",{className:"mt-2 flex gap-2 p-3 bg-gray-700 rounded-lg items-end border border-gray-600",children:[(0,s.jsx)("textarea",{ref:o,value:n,onChange:e=>l(e.target.value),placeholder:"Ask a question",className:"flex-1 bg-gray-600 text-gray-100 placeholder-gray-400 rounded-md border border-gray-500 px-3 py-2 text-sm  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none overflow-y-auto min-h-[40px]",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||r||(e.preventDefault(),i())},disabled:r,rows:1}),(0,s.jsx)(w,{onClick:i,className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors disabled:bg-gray-600 disabled:text-gray-400",disabled:r||!n.trim(),children:(0,s.jsx)(v.CIT,{size:"24px"})})]})},N=e=>{let{currentPoints:t,maxPoints:r,timeUntilNextRegen:n}=e,[l,o]=(0,a.useState)(n);(0,a.useEffect)(()=>{o(n)},[n]),(0,a.useEffect)(()=>{let e=setInterval(()=>{o(e=>Math.max(0,e-1))},1e3);return()=>clearInterval(e)},[]);let i=t/r*100;return(0,s.jsxs)("div",{className:"w-full mb-3 flex items-center justify-between gap-4",children:[(0,s.jsx)("h1",{className:"text-xl font-sans font-medium text-white",children:"CS 15 Tutor"}),(0,s.jsxs)("div",{className:"flex-1 max-w-48",children:[(0,s.jsx)("div",{className:"w-full h-2 bg-gray-700 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full transition-all duration-300 ".concat(i>60?"bg-emerald-500":i>30?"bg-amber-500":"bg-red-500"),style:{width:"".concat(i,"%")},children:(0,s.jsx)("div",{className:"h-full bg-gradient-to-r from-transparent to-white/20"})})}),0===t&&(0,s.jsx)("p",{className:"mt-1 text-xs text-red-400 text-right opacity-80",children:"Out of queries. Please wait."})]})]})},_=()=>{let{messages:e,isTyping:t,sendMessage:r,healthStatus:a}=x(),{chatRef:n,handleScroll:l}=f([e]);return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen w-full bg-gray-900",children:(0,s.jsxs)("div",{className:"flex flex-col h-[90vh] w-full max-w-4xl p-4 bg-gray-800 rounded-lg shadow-2xl border border-gray-700",children:[a&&(0,s.jsx)(N,{currentPoints:a.current_points,maxPoints:a.max_points,timeUntilNextRegen:a.time_until_next_regen}),(0,s.jsx)("div",{ref:n,onScroll:l,className:"flex-1 overflow-y-auto px-2 flex flex-col",children:e.map((e,t)=>(0,s.jsx)(p,{message:e},t))}),(0,s.jsx)(j,{onSendMessage:r,isDisabled:t||!!a&&!a.can_query})]})})};function E(){return(0,s.jsx)(_,{})}}},e=>{var t=t=>e(e.s=t);e.O(0,[753,877,636,593,792],()=>t(6760)),_N_E=e.O()}]);