(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[332],{5119:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var s=r(7876),a=r(4232),l=r(1423);let n={text:"Hi! I'm an experimental AI tutor for CS15. Queries are logged to help improve the tool. Responses may be inaccurate, so please think critically. Feel free to send feedback to nahuel.gomez_ruiz@tufts.edu.",sender:"bot",isStreaming:!1},o=()=>{let[e,t]=(0,a.useState)([n]),[r,s]=(0,a.useState)(""),[o,c]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{let e=localStorage.getItem("conversationId");if(e)s(e);else{let e=(0,l.A)();localStorage.setItem("conversationId",e),s(e)}},[]),{messages:e,conversationId:r,isTyping:o,setIsTyping:c,addMessage:e=>{t(t=>[...t,e])},updateLastMessage:function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t(t=>{let s=[...t],a=s[s.length-1];return a&&"bot"===a.sender&&(a.text=e,a.isStreaming=r),s})}}};var c=r(5364);class i{async sendMessage(e,t,r){try{var s;let a="true"===c.env.DEVELOPMENT_MODE,l={"Content-Type":"application/json"};a&&(l["X-Development-Mode"]="true",l["X-Remote-User"]="testuser");let n=await fetch("".concat(this.baseUrl,"/api/stream"),{method:"POST",headers:l,body:JSON.stringify({message:e,conversationId:t})});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));let o=null==(s=n.body)?void 0:s.getReader(),i=new TextDecoder,d="";if(!o)throw Error("No response body");for(;;){let{done:e,value:t}=await o.read();if(e)break;let s=(d+=i.decode(t,{stream:!0})).split("\n");for(let e of(d=s.pop()||"",s))if(e.startsWith("data: ")){let t=e.slice(6);if(t.trim())try{let e=JSON.parse(t);if("loading"===e.status&&r)r("Looking at course content...");else if("thinking"===e.status&&r)r("Thinking...");else if("complete"===e.status)return{response:e.response,rag_context:e.rag_context,conversation_id:e.conversation_id,health_status:e.health_status};else if("error"===e.status)throw Error(e.error||"Unknown error")}catch(e){console.error("Error parsing SSE data:",e)}}}throw Error("Stream ended without complete status")}catch(e){throw console.error("Error sending message:",e),Error("Error generating answer.")}}async checkHealth(){try{let e=await fetch("".concat(this.baseUrl,"/health"));return await e.json()}catch(e){throw console.error("Health check failed:",e),e}}async getHealthStatus(){try{let e={};"true"===c.env.DEVELOPMENT_MODE&&(e["X-Development-Mode"]="true",e["X-Remote-User"]="testuser");let t=await fetch("".concat(this.baseUrl,"/health-status"),{headers:e});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));return await t.json()}catch(e){throw console.error("Health status check failed:",e),e}}constructor(){this.baseUrl="https://cs-15-tutor.onrender.com"}}let d=new i,u=()=>{let{messages:e,conversationId:t,isTyping:r,setIsTyping:s,addMessage:l,updateLastMessage:n}=o(),[c,i]=(0,a.useState)(null);return(0,a.useEffect)(()=>{let e=async()=>{try{let e=await d.getHealthStatus();i(e)}catch(e){console.error("Failed to fetch health status:",e)}};e();let t=setInterval(e,3e4);return()=>clearInterval(t)},[]),{messages:e,isTyping:r,sendMessage:async e=>{if(e.trim()){if(c&&!c.can_query)return void l({text:"You've run out of queries. Please wait for your health points to regenerate.",sender:"bot"});l({text:e,sender:"user"}),s(!0),l({text:"Looking at course content...",sender:"bot",isStreaming:!0});try{let r=await d.sendMessage(e,t,e=>{n(e,!0)});r.response?(n(r.response,!1),console.log("RAG Context:",r.rag_context),r.health_status&&i(r.health_status)):r.error&&(n("Error: ".concat(r.error),!1),r.health_status&&i(r.health_status))}catch(e){console.error("Error sending message:",e),n(e instanceof Error?"Error: ".concat(e.message):"Error: An unexpected error occurred",!1)}finally{s(!1)}}},healthStatus:c}},h=e=>{let t=(0,a.useRef)(null),r=(0,a.useRef)(!0);return(0,a.useEffect)(()=>{t.current&&r.current&&(t.current.scrollTop=t.current.scrollHeight)},e),{chatRef:t,handleScroll:()=>{if(!t.current)return;let{scrollTop:e,scrollHeight:s,clientHeight:a}=t.current;r.current=s-e<=a+50}}};var x=r(9720);let g=()=>(0,s.jsx)("div",{className:"inline-block animate-spin rounded-full h-4 w-4 border-b-2 border-gray-300"}),m=e=>{let{message:t}=e,r="user"===t.sender,a=t.isStreaming&&("Looking at course content..."===t.text||"Thinking..."===t.text);return(0,s.jsx)("div",{className:"flex ".concat(r?"justify-end":"justify-start"," mb-4"),children:(0,s.jsx)("div",{className:"px-4 py-3 rounded-2xl max-w-[80%] shadow-sm ".concat(r?"bg-blue-600 text-white rounded-br-md":a?"bg-gray-700 text-gray-400 italic rounded-bl-md":"bg-gray-700 text-gray-100 rounded-bl-md"),children:a?(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(g,{}),(0,s.jsx)("span",{children:t.text})]}):r?(0,s.jsx)("div",{className:"whitespace-pre-wrap break-words text-sm",children:t.text}):(0,s.jsx)(x.oz,{className:"prose prose-sm max-w-none prose-p:my-2 prose-headings:my-2 text-sm prose-invert",components:{p:e=>{let{children:t}=e;return(0,s.jsx)("p",{className:"mb-2 last:mb-0 text-gray-100",children:t})},pre:e=>{let{children:t}=e;return(0,s.jsx)("div",{className:"overflow-x-auto my-2",children:(0,s.jsx)("pre",{className:"bg-gray-900 text-gray-100 p-3 rounded-lg overflow-x-auto text-xs border border-gray-600",children:t})})},code:e=>{let{className:t,children:r}=e;return t&&t.includes("language-")?(0,s.jsx)("code",{className:"bg-gray-900 text-gray-100",children:r}):(0,s.jsx)("code",{className:"bg-gray-600 text-gray-100 px-1 py-0.5 rounded text-xs",children:r})},h1:e=>{let{children:t}=e;return(0,s.jsx)("h1",{className:"text-lg font-bold text-gray-100 mb-2",children:t})},h2:e=>{let{children:t}=e;return(0,s.jsx)("h2",{className:"text-base font-bold text-gray-100 mb-2",children:t})},h3:e=>{let{children:t}=e;return(0,s.jsx)("h3",{className:"text-sm font-bold text-gray-100 mb-2",children:t})},ul:e=>{let{children:t}=e;return(0,s.jsx)("ul",{className:"list-disc list-inside text-gray-100 mb-2",children:t})},ol:e=>{let{children:t}=e;return(0,s.jsx)("ol",{className:"list-decimal list-inside text-gray-100 mb-2",children:t})},li:e=>{let{children:t}=e;return(0,s.jsx)("li",{className:"text-gray-100 mb-1",children:t})},strong:e=>{let{children:t}=e;return(0,s.jsx)("strong",{className:"font-bold text-gray-100",children:t})},em:e=>{let{children:t}=e;return(0,s.jsx)("em",{className:"italic text-gray-100",children:t})}},children:t.text})})})},f=e=>{let{children:t,...r}=e;return(0,s.jsx)("button",{...r,className:"px-4 py-2 rounded-full bg-cyan-600 text-black ".concat(r.className),children:t})};var b=r(329);let p=e=>{let{onSendMessage:t,isDisabled:r=!1}=e,[l,n]=(0,a.useState)(""),o=(0,a.useRef)(null);(0,a.useEffect)(()=>{if(o.current){o.current.style.height="auto";let e=o.current.scrollHeight;o.current.style.height="".concat(Math.min(e,200),"px")}},[l]);let c=()=>{l.trim()&&!r&&(t(l),n(""))};return(0,s.jsxs)("div",{className:"mt-2 flex gap-2 p-3 bg-gray-700 rounded-lg items-end border border-gray-600",children:[(0,s.jsx)("textarea",{ref:o,value:l,onChange:e=>n(e.target.value),placeholder:"Ask a question",className:"flex-1 bg-gray-600 text-gray-100 placeholder-gray-400 rounded-md border border-gray-500 px-3 py-2 text-sm  focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none overflow-y-auto min-h-[40px]",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||r||(e.preventDefault(),c())},disabled:r,rows:1}),(0,s.jsx)(f,{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white transition-colors disabled:bg-gray-600 disabled:text-gray-400",disabled:r||!l.trim(),children:(0,s.jsx)(b.CIT,{size:"24px"})})]})},y=e=>{let{currentPoints:t,maxPoints:r,timeUntilNextRegen:l}=e,[n,o]=(0,a.useState)(l);(0,a.useEffect)(()=>{o(l)},[l]),(0,a.useEffect)(()=>{let e=setInterval(()=>{o(e=>Math.max(0,e-1))},1e3);return()=>clearInterval(e)},[]);let c=t/r*100;return(0,s.jsxs)("div",{className:"w-full mb-3 flex items-center justify-between gap-4",children:[(0,s.jsx)("h1",{className:"text-xl font-sans font-medium text-white",children:"CS 15 Tutor"}),(0,s.jsxs)("div",{className:"flex-1 max-w-48",children:[(0,s.jsx)("div",{className:"w-full h-2 bg-gray-700 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full transition-all duration-300 ".concat(c>60?"bg-emerald-500":c>30?"bg-amber-500":"bg-red-500"),style:{width:"".concat(c,"%")},children:(0,s.jsx)("div",{className:"h-full bg-gradient-to-r from-transparent to-white/20"})})}),0===t&&(0,s.jsx)("p",{className:"mt-1 text-xs text-red-400 text-right opacity-80",children:"Out of queries. Please wait."})]})]})},w=()=>{let{messages:e,isTyping:t,sendMessage:r,healthStatus:a}=u(),{chatRef:l,handleScroll:n}=h([e]);return(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen w-full bg-gray-900",children:(0,s.jsxs)("div",{className:"flex flex-col h-[90vh] w-full max-w-4xl p-4 bg-gray-800 rounded-lg shadow-2xl border border-gray-700",children:[a&&(0,s.jsx)(y,{currentPoints:a.current_points,maxPoints:a.max_points,timeUntilNextRegen:a.time_until_next_regen}),(0,s.jsx)("div",{ref:l,onScroll:n,className:"flex-1 overflow-y-auto px-2 flex flex-col",children:e.map((e,t)=>(0,s.jsx)(m,{message:e},t))}),(0,s.jsx)(p,{onSendMessage:r,isDisabled:t||!!a&&!a.can_query})]})})};function v(){return(0,s.jsx)(w,{})}},6760:(e,t,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return r(5119)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[753,877,636,593,792],()=>t(6760)),_N_E=e.O()}]);